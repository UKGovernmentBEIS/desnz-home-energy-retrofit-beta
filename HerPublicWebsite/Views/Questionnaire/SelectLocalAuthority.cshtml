@using GovUkDesignSystem
@using GovUkDesignSystem.GovUkDesignSystemComponents
@using HerPublicWebsite.Controllers

@model HerPublicWebsite.Models.Questionnaire.SelectLocalAuthorityViewModel
@{
    ViewBag.Title = "Address";
}

@section BeforeMain {
    @await Html.GovUkBackLink(new BackLinkViewModel
           {
               Text = "Back",
               Href = Model.BackLink,
           })
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        
        <h1 class="govuk-heading-l">We couldn't find your local authority</h1>
        <p class="govuk-body">Click your local authority in the list below.</p>
        
        <div class="her_alphabet_links">
            @{
                var orderedLetters = Model.LocalAuthoritiesByInitial.Keys.OrderBy(k => k).ToList();
                var lettersInFirstRow = (orderedLetters.Count + 1) / 2;
            }
            <div class="her_alphabet_links__row">
                @for (var i = 0; i < lettersInFirstRow; i++)
                {
                    <span class="her_alphabet_links__letter"><a class="govuk-link" href="#@orderedLetters[i]">@orderedLetters[i]</a></span>
                }
            </div>
            <div class="her_alphabet_links__row">
                @for (var i = 0; i < lettersInFirstRow; i++)
                {
                    <span class="her_alphabet_links__letter">
                        @if (lettersInFirstRow + i < orderedLetters.Count)
                        {
                            <a class="govuk-link" href="#@orderedLetters[lettersInFirstRow + i]">@orderedLetters[lettersInFirstRow + i]</a>
                        }
                    </span>
                }
            </div>
        </div>
        
        @foreach (var localAuthoritiesForInitial in Model.LocalAuthoritiesByInitial.ToList().OrderBy(k => k.Key))
        {
            var orderedLaDetails = localAuthoritiesForInitial.Value.OrderBy(lad => lad.Name).ToList();
            var linksInFirstColumn = Math.Max((orderedLaDetails.Count + 1) / 2, 8);
            <div id="@localAuthoritiesForInitial.Key" class="her_local_authority_section">
                <h2 class="govuk-heading-s">@localAuthoritiesForInitial.Key<hr/></h2>
                
                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-one-half">
                        @foreach (var laDetails in orderedLaDetails.Take(linksInFirstColumn))
                        {
                            <a class="govuk-link" href="@Url.Action(nameof(QuestionnaireController.ConfirmLocalAuthority_Get), "Questionnaire", new { custodianCode = laDetails.CustodianCode })">@laDetails.Name</a>
                            <br/>
                        }
                    </div>
                    <div class="govuk-grid-column-one-half">
                        @foreach (var laDetails in orderedLaDetails.Skip(linksInFirstColumn))
                        {
                            <a class="govuk-link" href="@Url.Action(nameof(QuestionnaireController.ConfirmLocalAuthority_Get), "Questionnaire", new { custodianCode = laDetails.CustodianCode })">@laDetails.Name</a>
                            <br/>
                        }
                    </div>
                </div>
            </div> 
        }

    </div>
</div>
